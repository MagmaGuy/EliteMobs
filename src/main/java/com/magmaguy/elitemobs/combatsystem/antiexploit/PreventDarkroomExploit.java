package com.magmaguy.elitemobs.combatsystem.antiexploit;

import com.magmaguy.elitemobs.api.GenericAntiExploitEvent;
import com.magmaguy.elitemobs.config.AntiExploitConfig;
import com.magmaguy.elitemobs.utils.NonSolidBlockTypes;
import org.bukkit.event.EventHandler;
import org.bukkit.event.Listener;

public class PreventDarkroomExploit implements Listener {

    @EventHandler
    public void onDamage(GenericAntiExploitEvent event) {

        if (event.isCancelled()) return;

        //gets blocks at 1 height completely surrounding the entity
        if (AntiExploitConfig.darkroomAntiexploit1)
            if (!event.block021.isPassable() &&
                    !event.block120.isPassable() &&
                    !event.block122.isPassable() &&
                    !event.block221.isPassable()) {
                event.getEliteMobEntity().incrementAntiExploit(4, "darkroom coffin ring");
                return;
            }

        //gets blocks at 0 height plus if there's a block on top
        if (AntiExploitConfig.darkroomAntiexploit2)
            if ((!event.block011.isPassable() || !event.block021.isPassable()) &&
                    (!event.block110.isPassable() || !event.block120.isPassable()) &&
                    (!event.block112.isPassable() || !event.block122.isPassable()) &&
                    (!event.block211.isPassable() || !event.block221.isPassable()) &&
                    !event.ceilingMaterial.isPassable()) {
                event.getEliteMobEntity().incrementAntiExploit(4, "darkroom mine");
                return;
            }

        if (AntiExploitConfig.darkroomAntiexploit3)
            darkRoomAntiExploit3(event);

    }

    private void darkRoomAntiExploit3(GenericAntiExploitEvent event) {
        int wallCount = 0;
        if (!event.block011.isPassable() && !event.block021.isPassable())
            wallCount++;
        if (!event.block110.isPassable() && !event.block120.isPassable())
            wallCount++;
        if (!event.block112.isPassable() && !event.block122.isPassable())
            wallCount++;
        if (!event.block211.isPassable() && !event.block221.isPassable())
            wallCount++;

        if (wallCount >= 3)
            event.getEliteMobEntity().incrementAntiExploit(4, "darkroom walls");
    }

}
