package com.magmaguy.elitemobs.combatsystem.antiexploit;

import com.magmaguy.easyminecraftgoals.NMSManager;
import com.magmaguy.elitemobs.api.EliteMobDamagedByPlayerAntiExploitEvent;
import com.magmaguy.elitemobs.dungeons.EliteMobsWorld;
import org.bukkit.entity.EntityType;
import org.bukkit.entity.Mob;
import org.bukkit.event.EventHandler;
import org.bukkit.event.Listener;

public class PreventPathfindingExploit implements Listener {
    @EventHandler
    public void OnEliteDamagedbyPlayerEvent(EliteMobDamagedByPlayerAntiExploitEvent event) {
        if (event.isCancelled()) return;
        if (event.getEliteMobEntity().getLivingEntity() == null) return;
        if (!NMSManager.isEnabled()) return;
        //Only mobs pathfind
        if (!(event.getEliteMobEntity().getLivingEntity() instanceof Mob)) return;
        //Some mobs don't pathfind
        if (event.getEntity().getType().equals(EntityType.PHANTOM) ||
                event.getEntity().getType().equals(EntityType.RABBIT) ||
                event.getEntity().getType().equals(EntityType.MAGMA_CUBE) ||
                event.getEntity().getType().equals(EntityType.SLIME)) return;
        if (NMSManager.getAdapter().canReach(event.getEliteMobEntity().getLivingEntity(), event.getEliteMobDamagedByPlayerEvent().getPlayer().getLocation()))
            return;
        if (EliteMobsWorld.isEliteMobsWorld(event.getEntity().getWorld().getUID())) return;
        event.getEliteMobEntity().incrementAntiExploit(5, "no path to player");
    }
}
